2012.5.10

AD部分

1. AD测试步骤
   
   (1)用电位器给AD可确定输入，看AD转换结果是否正确，若不正确则多半是配置问题
	此次是 应设置AD为连续转换，来保证EOC中断够数(出现这种问题还是没配置好)
        规则组扫描转换因用了同一个通道转换的数据被覆盖了，所以只在一组中的最后一个通道转换完后进入EOC中断


   (2)测试硬件电路上给AD的待测电平是否正确，若不正确检查硬件
     	此次为1K电阻损坏，因运放输出正确，经过1K电阻后的电压不对
   
   (3)测试板子上各通道的采样是否正确，否则是EOC中断开关，通道转换逻辑不对
        此次先后将通道切换由定时器中断中切换改为在每个通道采样结束即EOC中断N次后切换，这样留了一定时延，保证通道切换的稳定性，然后等待在定时器中断中开启下一个通道的转换。



2. 定时器测试

   (1)在定时器中断中做一个取反输出，示波器检测定时器配置，定时时间是否准确
    
   (2)对定时器中断计数，将AD工作周期，和数据处理，通信等控制周期分开
   
   (3)36M->72M ?


3. 滤波，查表
   
   (1)此处采用简单的去头去尾均值滤波
	开始用先冒泡排序，后求均值的方法，增加了时间复杂度，后改为遍历一趟只找出最大最小值并求和，省掉排序时间
   
   (2)查表过程: AD转换值―AD Vin―运放Vin―PT100
	问题：pt100分度表给出的阻值含两位小数，在AD--Rt的计算过程中会出现分数等小数，
   	      编程时要考虑中间值计算的精度，浮点数与整型的转换等问题，
	方法：将分度表的值放大100倍，变为整形，AD--Rt的式子尽量把分母去掉把除的都换成乘的(把中间的小数变量放大10N倍成整型)，这样编程时都化为整形数据的运算又保证了精度。

   (3)测试调整各个参数
	AD
	运放放大倍数
	pt100阻值随温度变化的精度，温飘


4. 串口调试

   (1)485_ctr用普通IO口控制，实测时发现IO控制输出的稳定问题影响TX工作，加了1ms的延时
	
   (2)由查询TXE改为查询TC判断发送完成

5. 一些C语法问题
   
   (1)全局变量在函数外定义，在其他文件中使用时用extern声明下，外部全局变量定义时若不赋值,系统默认值为0
   (2)int型是32位的，not16位!
   (3)注“==”与其他运算符 的优先级，if中的条件表达式易错if( 5<=i<=10 ),应改为if( 5<=i && i<=10 )
   (4)continue与break的区别
   (5)无符号数与有符号的区别，特别是在判断语句中与负数相关的判断
